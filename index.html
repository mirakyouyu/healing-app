<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="mobile-web-app-capable" content="yes">
  <title>Healing Touch</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      overflow: hidden;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Hiragino Sans', sans-serif;
      background: #f5f5f0;
      height: 100vh;
      height: 100dvh;
      display: flex;
      flex-direction: column;
      color: #333;
      touch-action: none;
      -webkit-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
    }

    .video-section {
      position: relative;
      width: 100%;
      aspect-ratio: 16 / 10;
      background: linear-gradient(135deg, #7dd3c0 0%, #4a9e8c 30%, #2d7a6d 60%, #a8d5ba 100%);
      overflow: hidden;
    }

    video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .message-bubble {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(50, 60, 55, 0.85);
      color: white;
      padding: 16px 20px;
      border-radius: 12px;
      font-size: 14px;
      line-height: 1.7;
      text-align: center;
      max-width: 280px;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }

    .message-bubble.visible {
      opacity: 1;
    }

    .message-bubble::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      border-width: 10px 10px 0;
      border-style: solid;
      border-color: rgba(50, 60, 55, 0.85) transparent transparent;
    }

    .timer-bar {
      position: absolute;
      bottom: 16px;
      left: 20px;
      right: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .timer {
      color: white;
      font-size: 24px;
      font-weight: 500;
      text-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }

    .sound-btn {
      background: none;
      border: none;
      padding: 8px;
      cursor: pointer;
      color: white;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
    }

    .sound-btn svg {
      width: 32px;
      height: 32px;
      fill: currentColor;
    }

    .content-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      background: white;
      padding: 24px 20px;
    }

    .instruction {
      font-size: 18px;
      color: #d64545;
      font-weight: 500;
      margin-bottom: 8px;
      transition: color 0.3s ease;
    }

    .instruction.active {
      color: #4a9e8c;
    }

    .description {
      font-size: 14px;
      color: #666;
      text-align: center;
      line-height: 1.8;
      margin-bottom: 20px;
    }

    .touch-area {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 24px;
      width: 100%;
      background: #faf8f3;
      border-radius: 20px;
      padding: 20px;
    }

    .touch-circle {
      width: 140px;
      height: 140px;
      border-radius: 50%;
      background: #faf8f3;
      border: 2px solid #333;
      position: relative;
      overflow: hidden;
      transition: all 0.2s ease;
    }

    .touch-circle.pressed {
      background: rgba(74, 158, 140, 0.15);
      border-color: #4a9e8c;
    }

    .thumb-icon {
      position: absolute;
      bottom: -20px;
      width: 100%;
      height: 90%;
      opacity: 0.7;
    }

    .thumb-icon.left {
      left: -25px;
    }

    .thumb-icon.right {
      right: -25px;
    }

    .touch-circle.pressed .thumb-icon {
      opacity: 0.35;
    }

    .footer {
      padding: 12px;
      text-align: center;
      font-size: 12px;
      color: #999;
      background: white;
    }

    .healing-message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(50, 60, 55, 0.85);
      color: white;
      padding: 16px 20px;
      border-radius: 12px;
      font-size: 15px;
      line-height: 1.7;
      text-align: center;
      max-width: 280px;
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    .healing-message.visible {
      opacity: 1;
    }

    /* 小さい画面用 */
    @media (max-height: 700px) {
      .video-section {
        aspect-ratio: 16 / 8;
      }
      .content-section {
        padding: 16px;
      }
      .instruction {
        font-size: 16px;
      }
      .description {
        font-size: 13px;
        margin-bottom: 12px;
      }
      .touch-circle {
        width: 120px;
        height: 120px;
      }
    }

    /* 大きい画面用 */
    @media (min-height: 850px) {
      .touch-circle {
        width: 160px;
        height: 160px;
      }
    }
  </style>
</head>
<body>
  <div class="video-section">
    <video id="healingVideo" playsinline loop>
      <source src="healing.mp4" type="video/mp4">
    </video>

    <div class="healing-message" id="healingMessage"></div>

    <div class="timer-bar">
      <div class="timer" id="timer">00:00/3:45</div>
      <button class="sound-btn" id="soundBtn">
        <svg viewBox="0 0 24 24" id="soundIcon">
          <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
        </svg>
      </button>
    </div>
  </div>

  <div class="content-section">
    <p class="instruction" id="instruction">指の位置を検知できません。</p>
    <p class="description">表示されるイラストのように<br>円の中に指を置いてください。</p>

    <div class="touch-area" id="touchArea">
      <div class="touch-circle" id="leftCircle">
        <svg class="thumb-icon left" viewBox="0 0 120 140" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="skinL1" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:#f7e0d2"/>
              <stop offset="40%" style="stop-color:#f0d0be"/>
              <stop offset="100%" style="stop-color:#e5c4ac"/>
            </linearGradient>
            <linearGradient id="skinL2" x1="0%" y1="0%" x2="50%" y2="100%">
              <stop offset="0%" style="stop-color:#fae8dc"/>
              <stop offset="100%" style="stop-color:#f0d5c5"/>
            </linearGradient>
          </defs>
          <!-- 親指本体（左下から斜めに） -->
          <path d="M-10 180
                   Q 0 140, 25 100
                   Q 40 70, 55 45
                   Q 65 25, 75 15
                   Q 85 5, 95 10
                   Q 110 20, 105 45
                   Q 100 70, 90 100
                   Q 80 130, 75 160
                   Q 70 180, 50 190
                   Z"
                fill="url(#skinL1)"/>
          <!-- ハイライト -->
          <ellipse cx="70" cy="50" rx="18" ry="25" fill="url(#skinL2)" opacity="0.6"/>
          <!-- 関節の影 -->
          <path d="M35 95 Q55 88 80 95" stroke="#dbb89e" stroke-width="2" fill="none" opacity="0.3"/>
        </svg>
      </div>
      <div class="touch-circle" id="rightCircle">
        <svg class="thumb-icon right" viewBox="0 0 120 140" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="skinR1" x1="100%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color:#f7e0d2"/>
              <stop offset="40%" style="stop-color:#f0d0be"/>
              <stop offset="100%" style="stop-color:#e5c4ac"/>
            </linearGradient>
            <linearGradient id="skinR2" x1="100%" y1="0%" x2="50%" y2="100%">
              <stop offset="0%" style="stop-color:#fae8dc"/>
              <stop offset="100%" style="stop-color:#f0d5c5"/>
            </linearGradient>
          </defs>
          <!-- 親指本体（右下から斜めに） -->
          <path d="M130 180
                   Q 120 140, 95 100
                   Q 80 70, 65 45
                   Q 55 25, 45 15
                   Q 35 5, 25 10
                   Q 10 20, 15 45
                   Q 20 70, 30 100
                   Q 40 130, 45 160
                   Q 50 180, 70 190
                   Z"
                fill="url(#skinR1)"/>
          <!-- ハイライト -->
          <ellipse cx="50" cy="50" rx="18" ry="25" fill="url(#skinR2)" opacity="0.6"/>
          <!-- 関節の影 -->
          <path d="M40 95 Q65 88 85 95" stroke="#dbb89e" stroke-width="2" fill="none" opacity="0.3"/>
        </svg>
      </div>
    </div>
  </div>

  <div class="footer">© 2025 Healing Touch</div>

  <script>
    const video = document.getElementById('healingVideo');
    const instruction = document.getElementById('instruction');
    const healingMessage = document.getElementById('healingMessage');
    const touchArea = document.getElementById('touchArea');
    const leftCircle = document.getElementById('leftCircle');
    const rightCircle = document.getElementById('rightCircle');
    const timer = document.getElementById('timer');
    const soundBtn = document.getElementById('soundBtn');
    const soundIcon = document.getElementById('soundIcon');

    const healingMessages = [
      "深呼吸をして、心を落ち着けましょう",
      "今この瞬間に意識を集中してください",
      "あなたは十分に頑張っています",
      "ゆっくりと、自分のペースで",
      "心と体をリラックスさせましょう",
      "今日も一日、お疲れさまでした",
      "自分を大切にする時間です",
      "穏やかな気持ちで満たされていきます",
      "すべてはうまくいっています",
      "この静かな時間を楽しんでください"
    ];

    let isPlaying = false;
    let isMuted = false;
    let messageInterval = null;
    let currentMessageIndex = 0;
    let startTime = 0;
    let timerInterval = null;
    const totalDuration = 225; // 3:45 in seconds

    // タイマー更新
    function updateTimer() {
      if (!isPlaying) return;
      const elapsed = Math.floor((Date.now() - startTime) / 1000);
      const mins = Math.floor(elapsed / 60);
      const secs = elapsed % 60;
      const totalMins = Math.floor(totalDuration / 60);
      const totalSecs = totalDuration % 60;
      timer.textContent = `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}/${totalMins}:${String(totalSecs).padStart(2, '0')}`;
    }

    // 音声切り替え
    soundBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      isMuted = !isMuted;
      video.muted = isMuted;
      soundIcon.innerHTML = isMuted
        ? '<path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>'
        : '<path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>';
    });

    // タッチ位置が円の中にあるかチェック
    function isInsideCircle(touch, circle) {
      const rect = circle.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      const radius = rect.width / 2;
      const distance = Math.sqrt(
        Math.pow(touch.clientX - centerX, 2) +
        Math.pow(touch.clientY - centerY, 2)
      );
      return distance <= radius;
    }

    // タッチ状態を更新
    function updateTouchState(touches) {
      let leftTouched = false;
      let rightTouched = false;

      for (let touch of touches) {
        if (isInsideCircle(touch, leftCircle)) leftTouched = true;
        if (isInsideCircle(touch, rightCircle)) rightTouched = true;
      }

      leftCircle.classList.toggle('pressed', leftTouched);
      rightCircle.classList.toggle('pressed', rightTouched);

      const bothPressed = leftTouched && rightTouched;

      if (bothPressed && !isPlaying) {
        startHealing();
      } else if (!bothPressed && isPlaying) {
        pauseHealing();
      }
    }

    function startHealing() {
      isPlaying = true;
      video.play().catch(() => {});
      instruction.textContent = 'ヒーリング中...';
      instruction.classList.add('active');

      if (startTime === 0) startTime = Date.now();
      timerInterval = setInterval(updateTimer, 1000);

      showMessage();
      messageInterval = setInterval(() => {
        currentMessageIndex = (currentMessageIndex + 1) % healingMessages.length;
        showMessage();
      }, 10000);
    }

    function pauseHealing() {
      isPlaying = false;
      video.pause();
      instruction.textContent = '指の位置を検知できません。';
      instruction.classList.remove('active');

      healingMessage.classList.remove('visible');

      if (messageInterval) {
        clearInterval(messageInterval);
        messageInterval = null;
      }
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }

    function showMessage() {
      healingMessage.classList.remove('visible');
      setTimeout(() => {
        healingMessage.textContent = healingMessages[currentMessageIndex];
        healingMessage.classList.add('visible');
      }, 300);
    }

    // タッチイベント
    touchArea.addEventListener('touchstart', (e) => {
      e.preventDefault();
      updateTouchState(e.touches);
    }, { passive: false });

    touchArea.addEventListener('touchmove', (e) => {
      e.preventDefault();
      updateTouchState(e.touches);
    }, { passive: false });

    touchArea.addEventListener('touchend', (e) => {
      e.preventDefault();
      updateTouchState(e.touches);
    }, { passive: false });

    touchArea.addEventListener('touchcancel', (e) => {
      e.preventDefault();
      updateTouchState(e.touches);
    }, { passive: false });

    // 動画メタデータ読み込み時
    video.addEventListener('loadedmetadata', () => {
      const duration = video.duration || totalDuration;
      const mins = Math.floor(duration / 60);
      const secs = Math.floor(duration % 60);
      timer.textContent = `00:00/${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
    });
  </script>
</body>
</html>
